(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{529:function(e,t,a){e.exports=a(933)},534:function(e,t,a){},933:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a.n(n),o=a(45),c=a.n(o),i=(a(534),a(962)),l=a(948),s=a(960),u=a(964),d=a(952),m=a(261),f=a(497),p=a(182),E=a(954),h=a(961),g=a(498),b=a(959),v=a(965),w=a(955),k=a(957),O=a(956),j=a(958),y=a(154),P=a.n(y),x=a(229),T=a(258),C=a.n(T),D=function(){var e=Object(x.a)(P.a.mark(function e(t){var a,n,r,o,c,i,l,s,u;return P.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.files.title.split("."),n=t.files.title,r=a[1],console.log("Preparing the upload",n,r),e.next=6,C.a.post("/s3_sign",{fileName:n,fileType:r});case 6:if(o=e.sent){e.next=9;break}return e.abrupt("return",null);case 9:return console.log(o),c=o.data.data.returnData,i=c.signedRequest,l=c.url,console.log("Recieved a signed request "+i),s={headers:{"Content-Type":r},onUploadProgress:function(e){console.log(e.loaded)}},e.next=17,C.a.put(i,t.files.rawFile,s);case 17:if(u=e.sent,console.log("Response from s3",u),!u){e.next=21;break}return e.abrupt("return",l);case 21:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),S=function(e){var t=e.filename;C.a.post("/s3_delete",{fileName:t})},_=a(554),M=a(60),R=a(14),N=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/api";console.log(N);var J,A=(J=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:_.a.fetchJson,a=function(e){var t=e.pagination,a=t.page,n=t.perPage,r=e.sort,o=r.field,c=r.order;return o&&(e.filter.$sort=("DESC"===c?"-":"")+o),null!=e.filter.q&&(e.filter.$term=e.filter.q,delete e.filter.q),Object.assign(_.a.flattenObject(e.filter),{$limit:n,$page:a},o?{$sort:("DESC"===c?"-":"")+("id"===o?"_id":o)}:{})},n=function(e){var t=Object.assign({},e.data);return delete t.id,delete t.createdAt,delete t.updatedAt,delete t.deletedAt,delete t.isDeleted,JSON.stringify(t)};return function(r,o,c){if(r===R.i)return Promise.all(c.ids.map(function(a){return t("".concat(e,"/").concat(o,"/").concat(a),{method:"PATCH",body:JSON.stringify(c.data)})})).then(function(e){return{data:e.map(function(e){return e.json})}});if(r===R.c)return Promise.all(c.ids.map(function(a){return t("".concat(e,"/").concat(o,"/").concat(a),{method:"DELETE"})})).then(function(e){return{data:e.map(function(e){return e.json})}});var i=function(t,r,o){var c="",i={};switch(t){case R.d:var l=a(o);c="".concat(e,"/").concat(r,"?").concat(Object(M.stringify)(l));break;case R.g:c="".concat(e,"/").concat(r,"/").concat(o.id);break;case R.f:var s=a(o);s[o.target]=o.id,c="".concat(e,"/").concat(r,"?").concat(Object(M.stringify)(s));break;case R.h:c="".concat(e,"/").concat(r,"/").concat(o.id),i.method="PUT",i.body=n(o);break;case R.a:c="".concat(e,"/").concat(r),i.method="POST",i.body=n(o);break;case R.b:c="".concat(e,"/").concat(r,"/").concat(o.id),i.method="DELETE";break;case R.e:c="".concat(e,"/").concat(r,"?").concat(o.ids.map(function(e){return Object(M.stringify)({_id:e})}).join("&"));break;default:throw new Error("Unsupported fetch action type ".concat(t))}return{url:c,options:i}}(r,o,c),l=i.url,s=i.options;return t(l,s).then(function(e){return function(e,t,a,n){console.log(t,a,n);var r=e.json;switch(t){case R.d:case R.e:case R.f:return{data:r.docs.map(function(e){return(e.id=e._id)&&delete e._id&&e}),total:r.items.total};case R.a:return n.data.id=n.data._id,delete n.data._id,{data:n.data};case R.b:return{data:n};default:return r?(r.id=r._id,delete r._id,{data:r}):{data:{}}}}(e,r,o,c)})}}(N,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.headers||(t.headers=new Headers({Accept:"application/json"}));var a=localStorage.getItem("token");return t.headers.set("authorization","".concat(a)),_.a.fetchJson(e,t)}),function(){var e=Object(x.a)(P.a.mark(function e(t,a,n){var r,o;return P.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(t,a,n),"CREATE"!==t||"file"!==a){e.next=10;break}return e.next=4,D(n.data);case 4:if(!(r=e.sent)){e.next=9;break}return e.abrupt("return",J(t,a,{data:{filename:n.data.files.title,url:r}}));case 9:throw new Error("upload error");case 10:if("DELETE"!==t||"file"!==a){e.next=16;break}return e.next=13,J("GET_ONE","file",{id:n.id});case 13:(o=e.sent)&&o.data&&S(o.data),console.log("now dispatching normal delete request to api");case 16:if("DELETE_MANY"!==t||"file"!==a){e.next=18;break}throw new Error("not implemented");case 18:return e.abrupt("return",J(t,a,n));case 19:case"end":return e.stop()}},e)}));return function(t,a,n){return e.apply(this,arguments)}}()),q=a(230),I=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/api",L=function(e,t){if(e===q.d){var a=t.username,n=t.password,r=new Request(I+"/login",{method:"POST",body:JSON.stringify({username:a,password:n}),headers:new Headers({"Content-Type":"application/json"})});return fetch(r).then(function(e){if(e.status<200||e.status>=300)throw new Error(e.statusText);return e.json()}).then(function(e){var t=e.token;localStorage.setItem("token",t)})}if(e===q.e)return localStorage.removeItem("token"),Promise.resolve();if(e===q.b){var o=t.status;return 401===o||403===o?(localStorage.removeItem("token"),Promise.reject()):Promise.resolve()}return e===q.a?(console.log("auth check",localStorage.getItem("token")),localStorage.getItem("token")?Promise.resolve():Promise.reject()):Promise.reject("Unknown method")},$=a(499),Z=a(324),U=a(325),W=a(334),z=a(326),B=a(231),H=a(335),F=a(947),G=a(946),Y=a(455),K=a(46),Q=a(449),V=a.n(Q),X=a(451),ee=a.n(X),te=a(452),ae=a.n(te),ne=a(453),re=a.n(ne),oe=V()(function(e){var t=e.position,a=e.defaultZoom,n=e.handleMarkerDragEnd,o=e.onZoomChanged,c=e.radius,i=e.circleOptions,l=e.shouldRecenterMap,s=-1!==c?r.a.createElement(re.a,{center:t,radius:c,options:i}):null,u=l?{center:t}:{};return r.a.createElement(ee.a,Object.assign({onZoomChanged:o,defaultZoom:a,defaultCenter:t},u),r.a.createElement(ae.a,{draggable:!0,position:t,onDragEnd:n}),s)}),ce=function(e){function t(e){var a;return Object(Z.a)(this,t),(a=Object(W.a)(this,Object(z.a)(t).call(this,e))).state={position:e.defaultPosition,shouldRecenterMap:!1},a.handleMarkerDragEnd=a.handleMarkerDragEnd.bind(Object(B.a)(a)),a}return Object(H.a)(t,e),Object(U.a)(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.defaultPosition;JSON.stringify(t)!==JSON.stringify(this.props.defaultPosition)&&this.setState({position:t,shouldRecenterMap:!0})}},{key:"handleMarkerDragEnd",value:function(e){var t=this.props.onChange,a={lat:e.latLng.lat(),lng:e.latLng.lng()};this.setState({position:a,shouldRecenterMap:!1}),t(a)}},{key:"render",value:function(){var e=this.props,t=e.zoom,a=e.radius,n=e.circleOptions,o=e.containerElement,c=e.mapElement,i=this.state,l=i.position,s=i.shouldRecenterMap;return r.a.createElement(oe,{containerElement:o,mapElement:c,handleMarkerDragEnd:this.handleMarkerDragEnd,position:l,circleOptions:n,radius:a,defaultZoom:t,shouldRecenterMap:s})}}]),t}(n.Component);ce.defaultProps={zoom:10,radius:1e3,circleOptions:{fillColor:"red",fillOpacity:.2,strokeColor:"red",strokeOpacity:1,strokeWeight:1.2}};var ie={lat:27.9878,lng:86.925},le=function(e){function t(){return Object(Z.a)(this,t),Object(W.a)(this,Object(z.a)(t).apply(this,arguments))}return Object(H.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(G.a,null,function(t){t.formData;var a=t.dispatch;Object($.a)(t,["formData","dispatch"]);return r.a.createElement("div",null,r.a.createElement(ce,{containerElement:r.a.createElement("div",{style:{height:"100%"}}),mapElement:r.a.createElement("div",{style:{height:"400px"}}),defaultPosition:e.props.record.lat?{lat:e.props.record.lat,lng:e.props.record.lon}:ie,onChange:function(e){a(Object(K.b)(Y.a,"lat",e.lat)),a(Object(K.b)(Y.a,"lon",e.lng))}}),r.a.createElement(F.a,{source:"lat",label:"latitude"}),"\xa0",r.a.createElement(F.a,{source:"lon",label:"longitude"}))})}}]),t}(n.Component),se=r.a.createElement(i.a,null,r.a.createElement(l.a,{source:"key"}),r.a.createElement(l.a,{source:"content_en"}),r.a.createElement(l.a,{source:"content_no"})),ue=function(e){return r.a.createElement(s.a,e,se)},de=function(e){return r.a.createElement(u.a,e,se)},me=r.a.createElement(i.a,null,r.a.createElement(l.a,{source:"key"}),r.a.createElement(d.a,{source:"type",choices:[{id:"text",name:"Text"},{id:"number",name:"Number"}]}),r.a.createElement(l.a,{source:"value"})),fe=function(e){return r.a.createElement(s.a,e,me)},pe=function(e){return r.a.createElement(u.a,e,me)},Ee=function(e){return r.a.createElement(m.b,e,r.a.createElement(f.a,{rowClick:"edit"},r.a.createElement(p.a,{source:"name"}),r.a.createElement(p.a,{source:"locale"})))},he=r.a.createElement(i.a,null,r.a.createElement(l.a,{source:"name"}),r.a.createElement(E.a,{source:"description"}),r.a.createElement(d.a,{source:"locale",choices:[{id:"en",name:"en"},{id:"no",name:"no"}]}),r.a.createElement(le,null),r.a.createElement(h.a,{label:"audio 1",source:"audio1",reference:"file"},r.a.createElement(d.a,{optionText:"filename"})),r.a.createElement(h.a,{label:"audio 2",source:"audio2",reference:"file"},r.a.createElement(d.a,{optionText:"filename"})),r.a.createElement(h.a,{label:"audio 3",source:"audio3",reference:"file"},r.a.createElement(d.a,{optionText:"filename"}))),ge=function(e){return r.a.createElement(s.a,e,he)},be=function(e){return r.a.createElement(u.a,e,he)},ve=function(e){return r.a.createElement(m.b,Object.assign({},e,{bulkActionButtons:!1}),r.a.createElement(f.a,{rowClick:"edit"},r.a.createElement(p.a,{source:"filename"})))},we=function(e){return r.a.createElement(g.a,e,r.a.createElement(b.a,{undoable:!1,record:e.data}))},ke=function(e){return r.a.createElement(s.a,e,r.a.createElement(i.a,{toolbar:r.a.createElement(we,null)},r.a.createElement(p.a,{source:"filename"}),r.a.createElement(p.a,{source:"url"})))},Oe=function(e){return r.a.createElement(u.a,e,r.a.createElement(i.a,null,r.a.createElement(v.a,{source:"files",multiple:!1},r.a.createElement(w.a,{source:"filename",title:"title"}))))},je=function(){return r.a.createElement(k.a,{dataProvider:A,authProvider:L},r.a.createElement(O.a,{name:"place",list:Ee,edit:ge,create:be}),r.a.createElement(O.a,{name:"file",list:ve,edit:ke,create:Oe}),r.a.createElement(O.a,{name:"translation",list:j.a,edit:ue,create:de}),r.a.createElement(O.a,{name:"config",list:j.a,edit:fe,create:pe}))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(je,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[529,1,2]]]);
//# sourceMappingURL=main.dea6f167.chunk.js.map